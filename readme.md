# Gestor de Tareas con Arquitectura Multi-Base de Datos

Este proyecto es una aplicación web de gestión de tareas desarrollada con Python y Flask. Su propósito principal es servir como una herramienta educativa para demostrar una arquitectura de software moderna que integra múltiples tecnologías de bases de datos, cada una especializada en una tarea específica.

La aplicación permite a los usuarios registrarse, gestionar sus tareas, categorizarlas, registrar el tiempo invertido en ellas y analizar su productividad a través de un dashboard y reportes exportables.

## Características

- **Autenticación de Usuarios**: Registro e inicio de sesión seguros gestionados por Supabase.
- **Gestión Completa de Tareas**: Funcionalidades CRUD (Crear, Leer, Actualizar, Borrar) para las tareas.
- **Categorización**: Gestión de categorías de tareas en una base de datos SQLite local.
- **Registro de Tiempo**: Historial de tiempo invertido por tarea, almacenado en MySQL.
- **Dashboard Analítico**: Visualización del tiempo total agregado por tarea.
- **Exportación de Datos Avanzada**: Descarga de reportes en formato CSV (maestro, personal y por tabla individual).
- **API Segura**: Endpoint con autenticación básica para ser consumido por herramientas de BI como Power BI.
- **Contenerización**: Toda la aplicación y sus servicios están contenerizados con Docker para una fácil instalación y despliegue.

## Arquitectura Técnica

La aplicación utiliza un backend en **Python (Flask)** orquestado a través de **Docker Compose**. La característica más destacada es su capa de datos distribuida:

- **Supabase (PostgreSQL)**: Actúa como la base de datos principal en la nube para los datos transaccionales (tareas) y la autenticación de usuarios.
- **SQLite**: Se utiliza como una base de datos de configuración local, basada en archivos, para almacenar datos de catálogos (categorías).
- **MySQL/MariaDB**: Funciona como una base de datos analítica y de historial, ideal para almacenar logs (registros de tiempo) y realizar agregaciones.

---

## Guía de Instalación y Puesta en Marcha

Sigue estos pasos para tener la aplicación funcionando en tu máquina local.

### Prerrequisitos

- **Docker Desktop**: Asegúrate de tener Docker y Docker Compose instalados y en ejecución. Puedes descargarlo desde [docker.com](https://www.docker.com/products/docker-desktop/).
- **Cuenta de Supabase**: Necesitarás una cuenta gratuita de Supabase.

### Paso 1: Clonar el Repositorio

```bash
git clone <URL_DEL_REPOSITORIO>
cd <NOMBRE_DE_LA_CARPETA>
```

### Paso 2: Configuración del Proyecto en Supabase

1.  **Crea un nuevo proyecto** en tu panel de control de Supabase.
2.  **Crea la tabla `tasks`**:
    - Ve al **SQL Editor** en el menú de la izquierda.
    - Haz clic en **"New query"**.
    - Pega y ejecuta el siguiente código SQL para crear la tabla `tasks` con las columnas necesarias:
    ```sql
    CREATE TABLE public.tasks (
      id bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY,
      created_at timestamp with time zone NOT NULL DEFAULT now(),
      title text NOT NULL,
      done boolean NOT NULL DEFAULT false,
      user_id uuid NOT NULL,
      category_id integer,
      CONSTRAINT tasks_pkey PRIMARY KEY (id),
      CONSTRAINT tasks_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users (id) ON DELETE CASCADE
    );
    ```
3.  **Configura la Seguridad (RLS)**:
    - En el mismo **SQL Editor**, ejecuta el siguiente bloque de código para crear las políticas de seguridad. Esto es **crucial** para que la aplicación funcione.
    ```sql
    -- 1. Habilitar la Seguridad a Nivel de Fila (RLS)
    ALTER TABLE public.tasks ENABLE ROW LEVEL SECURITY;

    -- 2. Política para que los usuarios puedan LEER (SELECT) sus propias tareas
    CREATE POLICY "Los usuarios pueden ver sus propias tareas"
    ON public.tasks FOR SELECT
    TO authenticated
    USING (auth.uid() = user_id);

    -- 3. Política para que los usuarios puedan CREAR (INSERT) tareas para sí mismos
    CREATE POLICY "Los usuarios pueden crear sus propias tareas"
    ON public.tasks FOR INSERT
    TO authenticated
    WITH CHECK (auth.uid() = user_id);

    -- 4. Política para que los usuarios puedan ACTUALIZAR (UPDATE) sus propias tareas
    CREATE POLICY "Los usuarios pueden actualizar sus propias tareas"
    ON public.tasks FOR UPDATE
    TO authenticated
    USING (auth.uid() = user_id);

    -- 5. Política para que los usuarios puedan BORRAR (DELETE) sus propias tareas
    CREATE POLICY "Los usuarios pueden eliminar sus propias tareas"
    ON public.tasks FOR DELETE
    TO authenticated
    USING (auth.uid() = user_id);
    ```

### Paso 3: Configurar las Variables de Entorno

1.  En la raíz del proyecto, encontrarás un archivo llamado `.env.example`. **Crea una copia** de este archivo y renómbrala a `.env`.
2.  **Edita el archivo `.env`** y rellena los valores:
    - `SUPABASE_URL` y `SUPABASE_KEY`: Encuentra estos valores en tu proyecto de Supabase, en la sección **Project Settings > API**.
    - `MYSQL_...`: Puedes dejar los valores por defecto o personalizarlos. La contraseña que pongas aquí será la que usará el contenedor de Docker.
    - `API_...`: Define un usuario y contraseña para el acceso a la API de Power BI.

### Paso 4: Ejecutar la Aplicación

1.  Abre una terminal en la raíz del proyecto.
2.  Ejecuta el siguiente comando. La primera vez, Docker descargará las imágenes necesarias, lo que puede tardar unos minutos.
    ```bash
    docker-compose up --build
    ```
3.  Una vez que los contenedores estén en funcionamiento, la aplicación estará accesible en tu navegador en la siguiente dirección:
    http://localhost:5002

    *(Nota: Si el puerto 5002 está ocupado, puedes cambiarlo en el archivo `docker-compose.yml`)*.

---

## Conexión con Power BI

Puedes conectar Power BI (o cualquier otra herramienta de BI) a la API de la aplicación para analizar los datos.

- **Fuente de Datos**: Web
- **URL**: `http://localhost:5002/api/data`
- **Tipo de Autenticación**: Básica (Basic)
- **Usuario**: El valor que definiste para `API_USER` en tu archivo `.env`.
- **Contraseña**: El valor que definiste para `API_PASSWORD` en tu archivo `.env`.

## Estructura del Proyecto

```
/
|-- app.py                # Archivo principal de la aplicación Flask
|-- db_mysql.py           # Lógica de conexión e inicialización para MySQL
|-- db_sqlite.py          # Lógica de conexión e inicialización para SQLite
|-- requirements.txt      # Dependencias de Python
|-- Dockerfile            # Instrucciones para construir la imagen de la app
|-- docker-compose.yml    # Orquestación de los contenedores (app y mysql)
|-- .env.example          # Plantilla para las variables de entorno
|-- README.md             # Esta documentación
|-- templates/            # Carpeta con todas las plantillas HTML
|   |-- base.html
|   |-- tasks.html
|   |-- ...
```

```

### 2. Nuevo Archivo: `.env.example`

Este archivo sirve como una plantilla clara para que los usuarios sepan qué variables de entorno necesitan configurar.

```diff
# Variables de Entorno para la Aplicación
# Copia este archivo a .env y rellena los valores.

# Supabase - Encuentra estos valores en tu proyecto de Supabase > Project Settings > API
SUPABASE_URL="https://tu_id_de_proyecto.supabase.co"
SUPABASE_KEY="tu_llave_publica_anon"
FLASK_SECRET_KEY="una_frase_secreta_muy_larga_y_segura_para_las_sesiones_de_flask"

# MySQL/MariaDB - Credenciales para el contenedor de Docker
MYSQL_HOST="db"
MYSQL_USER="root"
MYSQL_PASSWORD="password_seguro_para_mysql"
MYSQL_DB="task_manager_db"

# Basic Auth para el API de Power BI
API_USER="powerbi"
API_PASSWORD="password_seguro_para_powerbi"
